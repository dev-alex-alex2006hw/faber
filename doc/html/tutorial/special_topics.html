

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="python" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="python" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Special Topics &mdash; Faber 1.0 documentation</title>
  

  
  
  
  

  

  
  
    

  

  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/graphviz.css" type="text/css" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Faber Reference" href="../reference/index.html" />
    <link rel="prev" title="Advanced concepts" href="advanced_concepts.html" /> 

  
  <script src="../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../index.html" class="icon icon-home"> Faber
          

          
            
            <img src="../_static/logo.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
              <div class="version">
                1.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../overview.html">Overview</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Tutorial</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="basic_concepts.html">Basic concepts</a></li>
<li class="toctree-l2"><a class="reference internal" href="advanced_concepts.html">Advanced concepts</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Special Topics</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#configuring-builds">Configuring Builds</a></li>
<li class="toctree-l3"><a class="reference internal" href="#running-tests">Running Tests</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../reference/index.html">Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../appendix.html">Appendix</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Faber</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
          <li><a href="index.html">Faber Tutorial</a> &raquo;</li>
        
      <li>Special Topics</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/tutorial/special_topics.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="special-topics">
<h1>Special Topics</h1>
<div class="section" id="configuring-builds">
<h2>Configuring Builds</h2>
<p>The build logic of a project may depend on features of the build platform that
isn't known in advance. The user (who does the build) may wish to provide some
parameters (such as prerequisite library paths), or check whether the compiler
supports the latest language features.</p>
<p>The <cite>faber.config</cite> subpackage provides facilities to perform such checks (akin
to those in the <cite>GNU autoconf tool</cite>). They define conditional features that
can be set either globally or for specific artefacts. For example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">faber.config</span> <span class="kn">import</span> <span class="n">cxx_checks</span><span class="p">,</span> <span class="n">report</span>

<span class="n">checks</span> <span class="o">=</span> <span class="p">[</span><span class="n">cxx_checks</span><span class="o">.</span><span class="n">has_cxx11</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">features</span><span class="p">,</span> <span class="n">define</span><span class="p">(</span><span class="s1">&#39;HAS_CXX11&#39;</span><span class="p">)),</span>
          <span class="n">cxx_checks</span><span class="o">.</span><span class="n">has_cxx14</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">features</span><span class="p">,</span> <span class="n">define</span><span class="p">(</span><span class="s1">&#39;HAS_CXX14&#39;</span><span class="p">)),</span>
          <span class="n">cxx_checks</span><span class="o">.</span><span class="n">has_cxx17</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">features</span><span class="p">,</span> <span class="n">define</span><span class="p">(</span><span class="s1">&#39;HAS_CXX17&#39;</span><span class="p">))]</span>

<span class="n">config</span> <span class="o">=</span> <span class="n">report</span><span class="p">(</span><span class="s1">&#39;config&#39;</span><span class="p">,</span> <span class="n">checks</span><span class="p">)</span>
<span class="n">check</span> <span class="o">=</span> <span class="n">binary</span><span class="p">(</span><span class="s1">&#39;check&#39;</span><span class="p">,</span> <span class="s1">&#39;main.cpp&#39;</span><span class="p">,</span> <span class="n">features</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">use</span><span class="p">)</span>
<span class="o">...</span>
</pre></div>
</div>
<p>The <cite>check</cite> binary gets its features from the <cite>config</cite> report, which performs
a set of checks, and then defines macros corresponding to the compiler features
that are detected. Injecting these features implies a dependency, so whenever
<cite>check</cite> needs to be built, the associated config checks will be done first.
(Faber provides some caching mechanism so these checks don't have to be re-run
if their values are already known.)</p>
</div>
<div class="section" id="running-tests">
<h2>Running Tests</h2>
<p>An important part of building software is testing. Code that has not been tested
adequately generally does not work. As test execution is often intimately tied to
the construction of the tested code, it is natural to integrate the relevant logic
into the construction tool itself.</p>
<p>Consider this fabscript snippet:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">faber.artefacts.binary</span> <span class="kn">import</span> <span class="n">binary</span>
<span class="kn">from</span> <span class="nn">faber.test</span> <span class="kn">import</span> <span class="n">test</span><span class="p">,</span> <span class="n">report</span><span class="p">,</span> <span class="n">fail</span>

<span class="n">passing</span> <span class="o">=</span> <span class="n">binary</span><span class="p">(</span><span class="s1">&#39;passing&#39;</span><span class="p">,</span> <span class="s1">&#39;passing.cpp&#39;</span><span class="p">)</span>
<span class="n">failing</span> <span class="o">=</span> <span class="n">binary</span><span class="p">(</span><span class="s1">&#39;failing&#39;</span><span class="p">,</span> <span class="s1">&#39;failing.cpp&#39;</span><span class="p">)</span>

<span class="n">test1</span> <span class="o">=</span> <span class="n">test</span><span class="p">(</span><span class="s1">&#39;test1&#39;</span><span class="p">,</span> <span class="n">passing</span><span class="p">,</span> <span class="n">run</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="n">test2</span> <span class="o">=</span> <span class="n">test</span><span class="p">(</span><span class="s1">&#39;test2&#39;</span><span class="p">,</span> <span class="n">failing</span><span class="p">,</span> <span class="n">run</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="n">test3</span> <span class="o">=</span> <span class="n">test</span><span class="p">(</span><span class="s1">&#39;test3&#39;</span><span class="p">,</span> <span class="n">failing</span><span class="p">,</span> <span class="n">run</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">expected</span><span class="o">=</span><span class="n">fail</span><span class="p">)</span>

<span class="o">...</span>
</pre></div>
</div>
<p>The above defines three tests consisting in running test binaries. For the sake
of example, let us assume that one of the binaries is passing and one is failing.
the <cite>test3</cite> above takes an optional argument to indicate that the test is expected
to fail.</p>
<p>While it is of course possible to run the tests explicitly from the command line
(using <cite>faber ... test1 test2 test3</cite>), it is much more useful to run them using
the built-in report mechanism. In addition to executing the selected tests this
may produce a test summary, or even a more elaborate test report:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">report</span><span class="p">(</span><span class="s1">&#39;test-report&#39;</span><span class="p">,</span> <span class="p">[</span><span class="n">test1</span><span class="p">,</span> <span class="n">test2</span><span class="p">,</span> <span class="n">test3</span><span class="p">])</span>
</pre></div>
</div>
<p>Invoking <cite>faber test-report</cite> will now generate output such as</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>test1: PASS
test2: FAIL
test3: XFAIL
test summary: 1 pass, 1 failure, 1 expected failure
</pre></div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../reference/index.html" class="btn btn-neutral float-right" title="Faber Reference" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="advanced_concepts.html" class="btn btn-neutral" title="Advanced concepts" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2016, Stefan Seefeld
      Last updated on Nov 29, 2018.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../_static/jquery.js"></script>
        <script type="text/javascript" src="../_static/underscore.js"></script>
        <script type="text/javascript" src="../_static/doctools.js"></script>
    

  

  <script type="text/javascript" src="../_static/js/theme.js"></script>

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>